# ==============================
# 基础设置
# ==============================
mixed-port: 7890
bind-address: 0.0.0.0
allow-lan: true
mode: rule
log-level: error
external-controller: 0.0.0.0:9090
ipv6: true

# ==============================
# TUN 模式
# ==============================
tun:
  enable: true
  stack: gvisor  # 更推荐 gVisor 隔离性强、兼容性好
  dns-hijack:
    - any:53  # 劫持所有 DNS 查询到本地 53 端口
  auto-route: true  # 自动配置路由表
  auto-detect-interface: true  # 自动检测网络接口
  strict-route: true  # 严格路由模式，避免路由泄漏
  mtu: 1500  # MTU 值，保持默认
  udp-fragment: true  # UDP 分片支持

# ==============================
# 流量嗅探
# ==============================
sniffing:
  enabled: true
  override-destination: true
  sniff:
    - tls
    - http

# ==============================
# DNS 配置
# ==============================
dns:
  enable: true
  ipv6: true
  listen: 0.0.0.0:53  # DNS 监听地址和端口
  enhanced-mode: fake-ip  # 启用 Fake-IP 模式，提高性能
  fake-ip-range: 198.18.0.1/16  # Fake-IP 地址范围
  default-nameserver:  # 默认 DNS，用于解析 Fake-IP
    - 114.114.114.114 # 骨干网 DNS
  nameserver:  # 主 DNS 服务器列表
    - 223.5.5.5  # 阿里公共 DNS
    - 223.6.6.6  # 阿里公共 DNS
    - 1.12.12.12 # 腾讯 DNSPod
    - 119.29.29.29 # DNSPod DNS
    - 8.8.8.8  # Google DNS
    - 1.1.1.1  # Cloudflare DNS
  fallback:  # 备用 DNS 服务器（用于防污染）
    - 8.8.8.8
    - 1.1.1.1
    - tls://dns.google  # DoT 加密 DNS
  nameserver-policy:  # DNS 分流策略
    'geosite:geolocation-cn': 223.6.6.6  # 中国大陆域名用阿里 DNS
    'geosite:geolocation-!cn': 8.8.8.8   # 非中国大陆域名用 Google DNS
    '+.google.com': 8.8.8.8
    '+.linkedin.com': 8.8.8.8
    '+.x.com': 8.8.8.8
    '+.tiktok.com': 8.8.8.8
    '+.youtube.com': 8.8.8.8
    '+.bing.com': 8.8.8.8
    '+.facebook.com': 8.8.8.8
    '+.netflix.com': 8.8.8.8
    '+.twitter.com': 8.8.8.8
    '+.reddit.com': 8.8.8.8
    '+.whatsapp.com': 8.8.8.8
    '+.github.com': 8.8.8.8
    '+.telegram.org': 8.8.8.8
    '+.pornhub.com': 8.8.8.8
    '+.sora.com': 8.8.8.8
    '+.fast.com': 8.8.8.8
    '+.openai.com': 8.8.8.8
    '+.chatgpt.com': 8.8.8.8
    '+.grok.com': 8.8.8.8

# ==============================
# 代理服务器
# ==============================
proxies:
  - {name: Alpha, type: vless, server: 190.93.246.55, port: 443, uuid: 351e3c90-7f9f-4f40-bccc-bee0bb0ca951, network: ws, tls: true, udp: false, sni: helloworld.fotoman.com, client-fingerprint: chrome, skip-cert-verify: false, ws-opts: {path: "/", headers: {Host: helloworld.fotoman.com}}}
  - {name: Delta, type: vless, server: 190.93.246.99, port: 443, uuid: e02a245e-5548-4bfc-888a-f4eb0bbb6b25, network: ws, tls: true, udp: false, sni: helloworld.techtrendparts.com, client-fingerprint: chrome, skip-cert-verify: false, ws-opts: {path: "/", headers: {Host: helloworld.techtrendparts.com}}}
  - {name: Gamma, type: vless, server: 190.93.246.61, port: 443, uuid: 5f2616c7-a69c-4a56-94b0-2aa4a25f878f, network: ws, tls: true, udp: false, sni: helloworld.todsm.com, client-fingerprint: chrome, skip-cert-verify: false, ws-opts: {path: "/", headers: {Host: helloworld.todsm.com}}}
  - {name: Beta, type: vless, server: helloworld.fotoman.com, port: 443, uuid: 351e3c90-7f9f-4f40-bccc-bee0bb0ca951, network: ws, tls: true, udp: false, sni: helloworld.fotoman.com, client-fingerprint: chrome, skip-cert-verify: false, ws-opts: {path: "/", headers: {Host: helloworld.fotoman.com}}}
  - {name: Theta, type: vless, server: helloworld.todsm.com, port: 443, uuid: 5f2616c7-a69c-4a56-94b0-2aa4a25f878f, network: ws, tls: true, udp: false, sni: helloworld.todsm.com, client-fingerprint: chrome, skip-cert-verify: false, ws-opts: {path: "/", headers: {Host: helloworld.todsm.com}}}
  - {name: JPN250, server: tky.todsm.com, port: 26197, type: vless, uuid: bced37a5-b0c7-4d9b-f4f5-19c01076fd87, tls: true, udp: false, skip-cert-verify: false, servername: tky.todsm.com, client-fingerprint: chrome, network: ws, ws-opts: {path: "/?ed=2560", headers: {Host: bing.com}}}
  - {name: JPN255, server: 45.76.220.255, port: 37399, type: vless, uuid: a3f5eefc-2f74-4758-a9ed-fd5a17a01c7b, tls: true, udp: false, skip-cert-verify: false, sni: la1.todsm.com, client-fingerprint: chrome, network: ws, ws-opts: {path: "/?ed=2560", headers: {Host: la1.todsm.com}}}

# ==============================
# 代理组
# ==============================
proxy-groups:
  - name: CDN
    type: url-test # load-balance # url-test
    proxies:
      - Alpha
      - Delta
      - Gamma
      - Beta
      - Theta
    url: https://www.google.com/generate_204
    interval: 300
    tolerance: 50
    icon: https://img.icons8.com/?size=100&id=S4NxkowMF95E&format=png&color=000000

  - name: LLM
    type: url-test
    proxies:
      - JPN255
      - JPN250
    url: https://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    lazy: true
    icon: https://img.icons8.com/?size=100&id=FWpoGgZY6IsM&format=png&color=000000

# ==============================
# 规则提供者
# ==============================
rule-providers:
  cname:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./ruleset/direct.yaml
    interval: 86400
  lancidr:
    type: http
    behavior: ipcidr
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt
    path: ./ruleset/lancidr.yaml
    interval: 604800
  cncidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: ./ruleset/cncidr.yaml
    interval: 86400

# ==============================
# 路由规则
# ==============================
rules:
  # Grok 独立访问域名
  - DOMAIN-SUFFIX,x.ai,JPN250
  - DOMAIN-SUFFIX,grok.com,JPN250
  
  # Twitter/X 主域名及子域名
  - DOMAIN-SUFFIX,twitter.com,JPN250
  - DOMAIN-SUFFIX,x.com,JPN250
  
  # Twitter/X 独立 CDN 和相关域名
  - DOMAIN-SUFFIX,twimg.com,JPN250
  - DOMAIN-SUFFIX,t.co,JPN250
  - DOMAIN-SUFFIX,pbs.twimg.com,JPN250
  - DOMAIN-SUFFIX,video.twimg.com,JPN250
  - DOMAIN-SUFFIX,ton.twimg.com,JPN250
  - DOMAIN-SUFFIX,syndication.twimg.com,JPN250
  - DOMAIN,analytics.twitter.com,JPN250
  - DOMAIN,api.twitter.com,JPN250
  - DOMAIN,ads.twitter.com,JPN250
  - DOMAIN,abs.twimg.com,JPN250  # 如果使用 Twitter 资产 CDN

  # 其他常见相关域名（可选，覆盖 API 和统计）
  - DOMAIN-SUFFIX,twitterudc.com,JPN250
  - DOMAIN-SUFFIX,twitterstat.com,JPN250

  # OpenAI/ChatGPT 主域名及子域名（覆盖 chat.openai.com、api.openai.com 等）
  - DOMAIN-SUFFIX,openai.com,JPN250
  
  # 其他常见相关域名（可选，覆盖认证和辅助服务）
  - DOMAIN-SUFFIX,auth0.openai.com,JPN250  # 认证服务
  - DOMAIN-SUFFIX,chatgpt.com,JPN250  # ChatGPT 短域名（重定向到 openai.com）

  # 按规则指定线路
  - DOMAIN-SUFFIX,alicdn.com,DIRECT
  - DOMAIN-KEYWORD,linkedin,LLM
  - DOMAIN-KEYWORD,licdn,LLM
  - DOMAIN-KEYWORD,yahoo,LLM
  - DOMAIN-KEYWORD,kickstarter,LLM
  - DOMAIN-KEYWORD,amazon,CDN
  - DOMAIN-KEYWORD,gemini,LLM
  
  - DOMAIN-SUFFIX,gemini.google.com,LLM
  - DOMAIN-KEYWORD,cloudflare,JPN250
  - DOMAIN-KEYWORD,tiktok,CDN
  - DOMAIN-SUFFIX,oaiusercontent.com,JPN255
  - DOMAIN-KEYWORD,sora,JPN255
  
  # 指定直联
  - DOMAIN-KEYWORD,shopline,DIRECT
  - DOMAIN-KEYWORD,keepa,DIRECT
  - DOMAIN-KEYWORD,slickdeals,DIRECT
  - DOMAIN-KEYWORD,dealnews,DIRECT
  - DOMAIN-KEYWORD,garmin,DIRECT
  - DOMAIN-KEYWORD,goofish,DIRECT
  - DOMAIN-KEYWORD,jd,DIRECT
  - DOMAIN-KEYWORD,tmall,DIRECT
  - DOMAIN-KEYWORD,taobao,DIRECT
  - DOMAIN-KEYWORD,qq,DIRECT
  - DOMAIN-KEYWORD,wechat,DIRECT
  - DOMAIN-KEYWORD,weixin,DIRECT
  - DOMAIN-SUFFIX,jd.com,DIRECT
  - DOMAIN-SUFFIX,komoot.com,DIRECT


  # 按IP地址直联
  - RULE-SET,cncidr,DIRECT
  - RULE-SET,lancidr,DIRECT
  
  # YouTube 主域名及子域名（覆盖 www.youtube.com、m.youtube.com 等）
  - DOMAIN-SUFFIX,youtube.com,Delta
  
  # YouTube 短链接域名
  - DOMAIN-SUFFIX,youtu.be,Delta
  
  # YouTube 图片和缩略图 CDN
  - DOMAIN-SUFFIX,ytimg.com,Delta
  
  # YouTube 视频流域名（核心视频内容）
  - DOMAIN-SUFFIX,googlevideo.com,Delta
  
  # 嵌入式 YouTube（无 Cookie 版本）
  - DOMAIN-SUFFIX,youtube-nocookie.com,Delta
  
  # 其他常见相关域名（可选，覆盖广告和统计）
  - DOMAIN-SUFFIX,yt.be,Delta  # 备用短链接
  - DOMAIN-SUFFIX,ggpht.com,Delta  # Google 图片代理，常用于 YouTube 缩略图

  # 按域名直联
  - RULE-SET,cname,DIRECT
  # 通配
  - MATCH,CDN
