# ==============================
# 基础设置
# ==============================
mixed-port: 7890
bind-address: 0.0.0.0
allow-lan: true
mode: rule
log-level: error
external-controller: 0.0.0.0:9090
ipv6: true

# ==============================
# TUN 模式
# ==============================
tun:
  enable: true
  stack: gvisor  # 更推荐 gVisor 隔离性强、兼容性好
  dns-hijack:
    - any:53  # 劫持所有 DNS 查询到本地 53 端口
  auto-route: true  # 自动配置路由表
  auto-detect-interface: true  # 自动检测网络接口
  strict-route: true  # 严格路由模式，避免路由泄漏
  mtu: 1500  # MTU 值，保持默认
  udp-fragment: true  # UDP 分片支持

# ==============================
# 流量嗅探
# ==============================
sniffing:
  enabled: true
  override-destination: true
  sniff:
    - tls
    - http

# ==============================
# DNS 配置
# ==============================
dns:
  enable: true
  ipv6: true
  listen: 0.0.0.0:53  # DNS 监听地址和端口
  enhanced-mode: fake-ip  # 启用 Fake-IP 模式，提高性能
  fake-ip-range: 198.18.0.1/16  # Fake-IP 地址范围
  default-nameserver:  # 默认 DNS，用于解析 Fake-IP
    - 114.114.114.114 # 骨干网 DNS
  nameserver:  # 主 DNS 服务器列表
    - 223.5.5.5  # 阿里公共 DNS
    - 223.6.6.6  # 阿里公共 DNS
    - 1.12.12.12 # 腾讯 DNSPod
    - 119.29.29.29 # DNSPod DNS
    - 8.8.8.8  # Google DNS
    - 1.1.1.1  # Cloudflare DNS
  fallback:  # 备用 DNS 服务器（用于防污染）
    - 8.8.8.8
    - 1.1.1.1
    - tls://dns.google  # DoT 加密 DNS
  nameserver-policy:  # DNS 分流策略
    'geosite:geolocation-cn': 223.6.6.6  # 中国大陆域名用阿里 DNS
    'geosite:geolocation-!cn': 8.8.8.8   # 非中国大陆域名用 Google DNS
    '+.google.com': 8.8.8.8
    '+.linkedin.com': 8.8.8.8
    '+.x.com': 8.8.8.8
    '+.tiktok.com': 8.8.8.8
    '+.youtube.com': 8.8.8.8
    '+.bing.com': 8.8.8.8
    '+.facebook.com': 8.8.8.8
    '+.netflix.com': 8.8.8.8
    '+.twitter.com': 8.8.8.8
    '+.reddit.com': 8.8.8.8
    '+.whatsapp.com': 8.8.8.8
    '+.github.com': 8.8.8.8
    '+.telegram.org': 8.8.8.8
    '+.pornhub.com': 8.8.8.8
    '+.sora.com': 8.8.8.8
    '+.fast.com': 8.8.8.8
    '+.openai.com': 8.8.8.8
    '+.chatgpt.com': 8.8.8.8
    '+.grok.com': 8.8.8.8

# ==============================
# 代理服务器
# ==============================
proxies:
  - {name: Alpha, type: vless, server: 190.93.246.68, port: 443, uuid: 351e3c90-7f9f-4f40-bccc-bee0bb0ca951, network: ws, tls: true, udp: false, sni: helloworld.fotoman.com, client-fingerprint: chrome, skip-cert-verify: false, ws-opts: {path: "/", headers: {Host: helloworld.fotoman.com}}}
  - {name: Delta, type: vless, server: 190.93.246.98, port: 443, uuid: e02a245e-5548-4bfc-888a-f4eb0bbb6b25, network: ws, tls: true, udp: false, sni: helloworld.techtrendparts.com, client-fingerprint: chrome, skip-cert-verify: false, ws-opts: {path: "/", headers: {Host: helloworld.techtrendparts.com}}}
  - {name: Gamma, type: vless, server: 172.64.38.160, port: 443, uuid: 5f2616c7-a69c-4a56-94b0-2aa4a25f878f, network: ws, tls: true, udp: false, sni: helloworld.todsm.com, client-fingerprint: chrome, skip-cert-verify: false, ws-opts: {path: "/", headers: {Host: helloworld.todsm.com}}}
  - {name: Beta, type: vless, server: 190.93.246.122, port: 443, uuid: 351e3c90-7f9f-4f40-bccc-bee0bb0ca951, network: ws, tls: true, udp: false, sni: helloworld.fotoman.com, client-fingerprint: chrome, skip-cert-verify: false, ws-opts: {path: "/", headers: {Host: helloworld.fotoman.com}}}
  - {name: Theta, type: vless, server: helloworld.todsm.com, port: 443, uuid: 5f2616c7-a69c-4a56-94b0-2aa4a25f878f, network: ws, tls: true, udp: false, sni: helloworld.todsm.com, client-fingerprint: chrome, skip-cert-verify: false, ws-opts: {path: "/", headers: {Host: helloworld.todsm.com}}}

# ai专用通道
  - name: "Trojan-TCP-AI"
    type: trojan
    server: 45.76.220.255
    port: 44926
    password: zConwdwyDR          # 对应链接中的密码部分
    udp: true
    sni: ai.todsm.com             # 对应链接中的 sni
    skip-cert-verify: false
    network: tcp
    client-fingerprint: chrome    # 对应 fp=chrome
    alpn:
      - h2
      - http/1.1
      
  - name: "VLESS-REALITY-XAI"
    type: vless
    server: xai.todsm.com
    port: 19996
    uuid: 833a7999-f857-4196-bb07-7005a7390a74
    udp: true
    tls: true
    network: tcp
    flow: xtls-rprx-vision             # 对应链接中的 flow=xtls-rprx-vision
    servername: xai.todsm.com          # 对应链接中的 sni
    reality-opts:
      public-key: 3ln_aNfomy1b6dgwxu_AvNji78rq5x9CaQJ5iTdT8TE  # 对应 pbk
      short-id: 6ba85179e30d4fc2                               # 对应 sid
    client-fingerprint: chrome         # 对应 fp=chrome

  - name: "VLESS-REALITY-AGI"
    type: vless
    server: agi.todsm.com
    port: 24785
    uuid: 7f375cd3-6f1c-4668-af87-9eb4d0d33f57
    udp: true
    tls: true
    network: tcp
    flow: xtls-rprx-vision
    servername: agi.todsm.com
    reality-opts:
      public-key: GsrvA5SAG6BSeGmpX4K-itGJNJHMYH3vTBSHZuKwHUU
      short-id: 6ba85179e30d4fc2
    client-fingerprint: chrome
    
# ==============================
# 代理组
# ==============================
proxy-groups:
  - name: CDN
    type: url-test # load-balance # url-test
    proxies:
      - Alpha
      - Delta
      - Gamma
      - Beta
      - Theta
    url: https://www.google.com/generate_204
    interval: 300
    tolerance: 50
    icon: https://img.icons8.com/?size=100&id=S4NxkowMF95E&format=png&color=000000

  - name: TCP
    type: url-test
    proxies:
      - Trojan-TCP-AI
      - VLESS-REALITY-XAI
      - VLESS-REALITY-AGI
    url: https://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    lazy: true
    icon: https://img.icons8.com/?size=100&id=FWpoGgZY6IsM&format=png&color=000000

# ==============================
# 规则提供者
# ==============================
rule-providers:
  cname:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./ruleset/direct.yaml
    interval: 86400
  lancidr:
    type: http
    behavior: ipcidr
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt
    path: ./ruleset/lancidr.yaml
    interval: 604800
  cncidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: ./ruleset/cncidr.yaml
    interval: 86400

# ==============================
# 路由规则
# ==============================
rules:
# ==============================
# Google Voice
# ==============================
- DOMAIN,voice.google.com,VLESS-REALITY-AGI
- DOMAIN-SUFFIX,voice.google.com,VLESS-REALITY-AGI
- DOMAIN-KEYWORD,google-voice,VLESS-REALITY-AGI
- DOMAIN-SUFFIX,telephony.goog,VLESS-REALITY-AGI
- DOMAIN-SUFFIX,googleapis.com,VLESS-REALITY-AGI
- DOMAIN,lens.l.google.com,VLESS-REALITY-AGI
- DOMAIN-SUFFIX,accounts.google.com,VLESS-REALITY-AGI
- DOMAIN,alt1-mtalk.google.com,VLESS-REALITY-AGI
- DOMAIN,alt2-mtalk.google.com,VLESS-REALITY-AGI
- DOMAIN,alt3-mtalk.google.com,VLESS-REALITY-AGI
- DOMAIN,alt4-mtalk.google.com,VLESS-REALITY-AGI
- DOMAIN,alt5-mtalk.google.com,VLESS-REALITY-AGI
- DOMAIN,alt6-mtalk.google.com,VLESS-REALITY-AGI
- DOMAIN,alt7-mtalk.google.com,VLESS-REALITY-AGI
- DOMAIN,alt8-mtalk.google.com,VLESS-REALITY-AGI
- DOMAIN,mtalk.google.com,VLESS-REALITY-AGI
# ==============================
# AI / LLM Services
# ==============================
- DOMAIN-SUFFIX,openai.com,TCP
- DOMAIN-SUFFIX,auth0.openai.com,TCP
- DOMAIN-SUFFIX,chatgpt.com,TCP
- DOMAIN-SUFFIX,oaistatic.com,TCP
- DOMAIN-SUFFIX,oaiusercontent.com,TCP
- DOMAIN-SUFFIX,sora.com,TCP

- DOMAIN-SUFFIX,x.ai,TCP
- DOMAIN-SUFFIX,grok.com,TCP
- DOMAIN-SUFFIX,auth.grokipedia.com,TCP

- DOMAIN-SUFFIX,perplexity.ai,TCP
- DOMAIN-SUFFIX,gemini.google.com,Trojan-TCP-AI

# 兜底 keyword（仅保留必要）
- DOMAIN-KEYWORD,openai,TCP
- DOMAIN-KEYWORD,grok,TCP
- DOMAIN-KEYWORD,sora,TCP

# ==============================
# Overseas SaaS / Social
# ==============================
- DOMAIN-SUFFIX,gitHub.com,VLESS-REALITY-XAI
- DOMAIN-KEYWORD,gitHub,VLESS-REALITY-XAI
- DOMAIN-SUFFIX,linkedin.com,TCP
- DOMAIN-SUFFIX,licdn.com,TCP
- DOMAIN-SUFFIX,apollo.io,TCP
- DOMAIN-SUFFIX,kickstarter.com,TCP
- DOMAIN-SUFFIX,yahoo.com,TCP
- DOMAIN-SUFFIX,reddit.com,TCP
- DOMAIN-SUFFIX,redd.it,CDN
- DOMAIN-KEYWORD,redd,CDN
# ==============================
# Media / CDN
# ==============================
- DOMAIN-SUFFIX,tiktok.com,CDN
- DOMAIN-SUFFIX,tiktokcdn.com,CDN
- DOMAIN-SUFFIX,byteoversea.com,CDN
# ==============================
# Force DIRECT
# ==============================
- DOMAIN-SUFFIX,komoot.com,DIRECT
- DOMAIN-SUFFIX,abchina.com,DIRECT     #农业银行
- DOMAIN-SUFFIX,abchina.com.cn,DIRECT  #农业银行
- DOMAIN-SUFFIX,ecitic.com,DIRECT      #中信银行
- DOMAIN-SUFFIX,jd.com,DIRECT          #京东商城
- DOMAIN-SUFFIX,keepa.com,DIRECT       #keepa
- DOMAIN-SUFFIX,quanmaitong.com,DIRECT #全麦通
- DOMAIN-SUFFIX,shopline.com,DIRECT    #shopline
- DOMAIN-KEYWORD,myshopline,DIRECT     #shopline
- DOMAIN,loader.fo,VLESS-REALITY-AGI   #YouTube下载器
# ==============================
# Mainland China
# ==============================
- RULE-SET,cncidr,DIRECT
- RULE-SET,lancidr,DIRECT
- RULE-SET,cname,DIRECT
# ==============================
# Fallback
# ==============================
- MATCH,CDN
